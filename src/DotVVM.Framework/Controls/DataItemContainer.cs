using System;
using System.Collections.Generic;
using System.Linq;
using DotVVM.Framework.Hosting;
using DotVVM.Framework.Runtime;

namespace DotVVM.Framework.Controls
{
    /// <summary>
    /// Used in <see cref="ItemsControl" /> to wrap each data item and generate its unique ID.
    /// </summary>
    public class DataItemContainer : DotvvmControl
    {

        /// <summary>
        /// Initializes a new instance of the <see cref="DataItemContainer"/> class.
        /// </summary>
        public DataItemContainer()
        {
            SetValue(Internal.IsNamingContainerProperty, true);
            SetValue(ClientIDModeProperty, ClientIDMode.AutoGenerated);
        }


        /// <summary>
        /// Gets or sets the index of the data item in the data source control.
        /// </summary>
        public int? DataItemIndex
        {
            get
            {
                var value = GetValue(Internal.UniqueIDProperty);
                return value is string id && int.TryParse(id, out var index) ? index : (int?)null;
            }
            set { SetValue(Internal.UniqueIDProperty, value != null ? value.ToString() : null); }
        }
        
    }
}